profiles {
    standard {
        workDir = "work"
        resume = true  // null for no resume
        docker {
            enabled = true
        }
        params {
            datadir = "test/"
            manifest = "test/manifest.csv"
            output = "output"
            take = 5 // -1 all
        }
        process {
            cpus = 16
            errorStrategy = "ignore"
            executor = "local"
            memory = 32.GB
            withLabel: fastqc_mem {
                // fastqc --help: "Each thread will be allocated 250MB of mem"
                memory = { 250.MB * task.cpus }
            }
        }
        executor {
            queueSize = 4
        }
    }

    uw_batch {
        workDir = "s3://molmicro-data/nextflow-workdir/place-16s"
        process {
            scratch = "/docker_scratch"
            queue = "molmicro-queue"
            executor = "awsbatch"

            // allocate resources according to labels; see
            // https://www.nextflow.io/docs/latest/config.html#scope-process
            // https://www.nextflow.io/docs/latest/process.html#label
            withLabel: med_cpu_mem {
                cpus = 8
                memory = { 8.GB * task.attempt }
                errorStrategy = "retry"
                maxRetries = 3
            }
        }
        aws {
            region = "us-west-2"
            batch {
                volumes = "/docker_scratch"
                cliPath = "/home/ec2-user/miniconda/bin/aws"
            }
        }
    }

    hutch_batch {
        workDir = "s3://fh-pi-fredricks-d/lab/crosenth/hcov19/work"
        resume = true
        params {
            datadir = "s3://fh-pi-fredricks-d/lab/crosenth/hcov19/data/"
            manifest = "test/manifest.csv"
            output = "output"
            take = -1 // -1 all
        }
        process {
            executor = "awsbatch"
            scratch = "/tmp"
            // https://sciwiki.fredhutch.org/scicomputing/compute_cloud/#choose-a-job-queue
            queue = "cpu-spot-50"
            errorStrategy = "ignore"
            cpus = 8
            memory = 64.GB
            // allocate resources according to labels; see
            // https://www.nextflow.io/docs/latest/config.html#scope-process
            // https://www.nextflow.io/docs/latest/process.html#label
            withLabel: med_cpu_mem {
                cpus = 8
                memory = 16.GB
                maxRetries = 3
            }
            withLabel: fastqc_mem {
                // fastqc --help: "Each thread will be allocated 250MB of mem"
                memory = { 250.MB * task.cpus }
            }
        }
        aws {
            batch {
                // https://github.com/nextflow-io/nextflow/issues/849
                cliPath = "/home/ec2-user/miniconda/bin/aws"
                volumes = ['/docker_scratch:/tmp:rw']
                jobRole = "arn:aws:iam::064561331775:role/fh-pi-fredricks-d-batchtask"
            }
        }
        executor {
            queueSize = 500
        }
    }
}

trace {
    enabled = true
    file = "output/execution/trace.csv"
    sep = ","
    fields = "task_id,hash,native_id,tag,name,status,exit,submit,duration,realtime,%cpu,rss,vmem,rchar,wchar"
}

report {
    enabled = true
    file = "output/execution/report.html"
}
